(function(e){function t(t){for(var r,n,i=t[0],c=t[1],u=t[2],l=0,d=[];l<i.length;l++)n=i[l],Object.prototype.hasOwnProperty.call(o,n)&&o[n]&&d.push(o[n][0]),o[n]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);p&&p(t);while(d.length)d.shift()();return s.push.apply(s,u||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],r=!0,n=1;n<a.length;n++){var i=a[n];0!==o[i]&&(r=!1)}r&&(s.splice(t--,1),e=c(c.s=a[0]))}return e}var r={},n={app:0},o={app:0},s=[];function i(e){return c.p+"js/"+({about:"about"}[e]||e)+"."+{about:"eb458408","chunk-2d2383f8":"43592765"}[e]+".js"}function c(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,c),a.l=!0,a.exports}c.e=function(e){var t=[],a={about:1};n[e]?t.push(n[e]):0!==n[e]&&a[e]&&t.push(n[e]=new Promise((function(t,a){for(var r="css/"+({about:"about"}[e]||e)+"."+{about:"6045400d","chunk-2d2383f8":"31d6cfe0"}[e]+".css",o=c.p+r,s=document.getElementsByTagName("link"),i=0;i<s.length;i++){var u=s[i],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===r||l===o))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){u=d[i],l=u.getAttribute("data-href");if(l===r||l===o)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var r=t&&t.target&&t.target.src||o,s=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");s.code="CSS_CHUNK_LOAD_FAILED",s.request=r,delete n[e],p.parentNode.removeChild(p),a(s)},p.href=o;var f=document.getElementsByTagName("head")[0];f.appendChild(p)})).then((function(){n[e]=0})));var r=o[e];if(0!==r)if(r)t.push(r[2]);else{var s=new Promise((function(t,a){r=o[e]=[t,a]}));t.push(r[2]=s);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=i(e);var d=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(p);var a=o[e];if(0!==a){if(a){var r=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+r+": "+n+")",d.name="ChunkLoadError",d.type=r,d.request=n,a[1](d)}o[e]=void 0}};var p=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},c.m=e,c.c=r,c.d=function(e,t,a){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(c.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(a,r,function(t){return e[t]}.bind(null,r));return a},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var p=l;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"22bc":function(e,t,a){e.exports=a.p+"img/icon_vanilla.1c9b3430.png"},"294d":function(e,t,a){"use strict";a("9ea8")},"3db6":function(e,t,a){e.exports=a.p+"img/vanilla_white.34deb758.png"},4396:function(e,t,a){e.exports=a.p+"img/BPMConseil.0f4f5753.png"},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("2b0e"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",{staticClass:"grey lighten-4"},[e.loaded?a("div",[a("Navbar"),a("v-main",{staticClass:"mx-4 pb-15"},[a("router-view")],1),a("Footer")],1):a("div",[a("v-overlay",{attrs:{opacity:"1",value:"true"}},[e.loadingCircular?a("v-progress-circular",{attrs:{indeterminate:"",size:"100"}},[e._v(" "+e._s(e.loadingMsg)+" ")]):a("div",{staticClass:"ma-5"},[e._v(" "+e._s(e.loadingMsg)+" ")])],1)],1)])},o=[],s=a("b85c"),i=(a("d3b7"),a("b0c0"),a("3ca3"),a("ddb0"),a("7db0"),a("a434"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("nav",[r("v-app-bar",{staticClass:"indigo",attrs:{flat:""}},[r("v-app-bar-nav-icon",{staticClass:"white--text",on:{click:function(t){e.drawer=!e.drawer}}}),r("v-toolbar-title",{staticClass:"text-uppercase white--text"},[r("span",{staticClass:"font-weight-light"},[e._v("VANILLA")]),r("span",[e._v(" PORTAIL")])]),r("v-spacer"),r("v-toolbar-title",{staticClass:"text-uppercase white--text"},[r("span",{staticClass:"font-weight-light"},[e._v("Connecté en tant que : ")]),r("span",[e._v(" "+e._s(e.name()))])]),r("v-spacer"),r("v-btn",{staticClass:"mx-3",attrs:{dark:"",text:"",rounded:""},on:{click:e.logout}},[e._v("Déconnexion")]),r("v-btn",{staticClass:"mx-3",attrs:{text:"",rounded:"",target:"_blank",rel:"noopener noreferrer",href:"https://semaphore-vanilla.data4citizen.com/vanilla"}},[r("v-img",{attrs:{contain:"","max-height":"100","max-width":"120",src:a("3db6")}}),r("v-icon",{staticClass:"ml-1 mt-1",attrs:{medium:"",color:"white"}},[e._v("mdi-open-in-new")])],1)],1),r("v-navigation-drawer",{staticClass:"indigo",attrs:{app:"",temporary:""},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[r("v-layout",{attrs:{column:"","align-center":""}},[r("v-flex",{staticClass:"mt-5"},[r("v-avatar",{attrs:{size:"100"}},[r("img",{attrs:{src:a("22bc")}})])],1)],1),r("v-list",e._l(e.links,(function(t){return r("v-list-item",{key:t.text,attrs:{to:t.route}},[r("v-list-item-action",[r("v-icon",{staticClass:"white--text"},[e._v(e._s(t.icon))])],1),r("v-list-item-content",[r("v-list-item-title",{staticClass:"white--text"},[e._v(e._s(t.text))])],1)],1)})),1)],1)],1)}),c=[],u={name:"Navbar",data:function(){return{drawer:!1,links:[{icon:"mdi-chart-bell-curve",text:"Charts",route:"/"}]}},methods:{logout:function(){r["a"].$keycloak.logout({redirectUri:window.location.origin})},name:function(){return r["a"].$keycloak.tokenParsed.preferred_username}}},l=u,d=a("2877"),p=a("6544"),f=a.n(p),m=a("40dc"),g=a("5bc1"),h=a("8212"),v=a("8336"),b=a("0e8f"),y=a("132d"),w=a("adda"),k=a("a722"),x=a("8860"),E=a("da13"),C=a("1800"),_=a("5d23"),L=a("f774"),T=a("2fa4"),O=a("2a7f"),I=Object(d["a"])(l,i,c,!1,null,null,null),P=I.exports;f()(I,{VAppBar:m["a"],VAppBarNavIcon:g["a"],VAvatar:h["a"],VBtn:v["a"],VFlex:b["a"],VIcon:y["a"],VImg:w["a"],VLayout:k["a"],VList:x["a"],VListItem:E["a"],VListItemAction:C["a"],VListItemContent:_["a"],VListItemTitle:_["b"],VNavigationDrawer:L["a"],VSpacer:T["a"],VToolbarTitle:O["a"]});var U=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-footer",{attrs:{id:"dashboard-core-footer",height:"60",absolute:"",padless:""}},[r("v-container",[r("v-row",{attrs:{align:"left","no-gutters":""}},[r("v-col",{staticClass:"text-center mb-sm-0 mb-5",attrs:{cols:"auto"}},[r("v-btn",{attrs:{icon:"",color:"primary",to:"/"}},[r("v-icon",{attrs:{size:"24px"}},[e._v("mdi-home")])],1)],1),r("v-col",{staticClass:"text-center mb-sm-0 mb-5",attrs:{cols:"auto"}},[r("v-btn",{attrs:{text:"",rounded:"",target:"_blank",rel:"noopener noreferrer",href:"https://semaphore-vanilla.data4citizen.com/vanilla"}},[r("v-img",{attrs:{"max-height":"24","max-width":"90",src:a("f9c4")}})],1)],1),r("v-col",{staticClass:"text-center mb-sm-0 mb-5",attrs:{cols:"auto"}},[r("v-btn",{staticClass:"ma-0",attrs:{text:"",rounded:"",target:"_blank",rel:"noopener noreferrer",href:"http://www.bpm-conseil.com/fr"}},[r("v-img",{attrs:{"max-height":"24","max-width":"90",src:a("4396")}})],1)],1),r("v-spacer",{staticClass:"hidden-sm-and-down"}),r("v-col",{attrs:{cols:"12",md:"auto"}},[r("div",{staticClass:"body-1 font-weight-light pt-6 pt-md-0 text-center"},[e._v(" Copyright © BPM-Conseil, 2013 - "+e._s((new Date).getFullYear())+". ")])])],1)],1)],1)},V=[],S={name:"Footer"},N=S,R=(a("294d"),a("62ad")),$=a("a523"),j=a("553a"),A=a("0fd9"),F=Object(d["a"])(N,U,V,!1,null,null,null),D=F.exports;f()(F,{VBtn:v["a"],VCol:R["a"],VContainer:$["a"],VFooter:j["a"],VIcon:y["a"],VImg:w["a"],VRow:A["a"],VSpacer:T["a"]});var M={name:"App",components:{Navbar:P,Footer:D},props:["keycloak"],data:function(){return{loaded:!1,loadingMsg:"Loading...",loadingCircular:!0}},beforeMount:function(){var e=this;this.manageKeycloakUser().then((function(){e.appLoadData()}))},methods:{appLoadData:function(){var e=this,t=r["a"].$keycloak.tokenParsed.preferred_username;this.$store.dispatch("getUser",t).then((function(){e.$store.dispatch("getGroups").then((function(){e.$store.dispatch("getRepositories",t).then((function(){e.loaded=!0}))}))})).catch((function(){e.loadingMsg="Impossible d'établir la connexion au serveur, veuillez rafraichir la page ou contacter l'administrateur.",e.loadingCircular=!1}))},manageKeycloakUser:function(){var e=this,t=r["a"].$keycloak.tokenParsed.preferred_username,a=r["a"].$keycloak.tokenParsed.groups;return new Promise((function(n){e.$store.dispatch("getUserGroups",{userLogin:t}).then((function(r){var o,i=r,c=[],u=Object(s["a"])(a);try{var l=function(){var a=o.value;d=i.find((function(e){return e.name==a})),void 0==d?c.push(e.$store.dispatch("addUserToGroup",{userLogin:t,groupName:a})):i.splice(i.indexOf(d),1)};for(u.s();!(o=u.n()).done;){var d;l()}}catch(g){u.e(g)}finally{u.f()}if(i.length>0){var p,f=Object(s["a"])(i);try{for(f.s();!(p=f.n()).done;){var m=p.value;c.push(e.$store.dispatch("removeUserFromGroup",{userLogin:t,groupName:m.name}))}}catch(g){f.e(g)}finally{f.f()}}Promise.all(c).then((function(){n()}))})).catch((function(o){if("User not found."==o){var i={name:t,login:t,password:"Default",mail:r["a"].$keycloak.tokenParsed.email},c=[];e.$store.dispatch("addUser",i).then((function(){var r,n=Object(s["a"])(a);try{for(n.s();!(r=n.n()).done;){var o=r.value;c.push(e.$store.dispatch("addUserToGroup",{userLogin:t,groupName:o}))}}catch(i){n.e(i)}finally{n.f()}})),Promise.all(c).then((function(){n()}))}}))}))}}},G=M,H=a("7496"),z=a("f6c4"),B=a("a797"),q=a("490a"),K=Object(d["a"])(G,n,o,!1,null,null,null),J=K.exports;f()(K,{VApp:H["a"],VMain:z["a"],VOverlay:B["a"],VProgressCircular:q["a"]});a("25f0"),a("fb6a");var Y=a("8c4f");r["a"].use(Y["a"]);var X=[{path:"/",name:"Home",component:function(){return a.e("about").then(a.bind(null,"bb51"))},meta:{isAuthenticated:!0}},{path:"/unauthorized",name:"Unauthorized",meta:{isAuthenticated:!1},component:function(){return a.e("chunk-2d2383f8").then(a.bind(null,"ff24"))}}],Q=new Y["a"]({routes:X});Q.beforeEach((function(e,t,a){if(e.meta.isAuthenticated){var n=window.location.toString();r["a"].$keycloak.authenticated?r["a"].$keycloak.hasResourceRole("acces-portail")?r["a"].$keycloak.updateToken(70).then((function(){a()})).catch((function(e){console.error(e)})):a({name:"Unauthorized"}):r["a"].$keycloak.login({redirectUri:n.slice(0,-1)+e.path})}else a()}));var W=Q,Z=a("1da1"),ee=(a("96cf"),a("159b"),a("99af"),a("caad"),a("2532"),a("2f62")),te=a("bc3a"),ae=a.n(te),re=a("7dc5");ae.a.defaults.baseURL=re.baseURL,ae.a.defaults.headers.common["X-Gravitee-Api-Key"]="f3510842-ef9b-4ee7-8877-4d59b5d63907",r["a"].use(ee["a"]);var ne=new ee["a"].Store({state:{users:{name:"Utilisateurs",data:[]},groups:{name:"Groupes",data:[]},repositories:{name:"Repositories",data:[]},items:{name:"Items",data:[]},temps:{name:"Temps",data:[]}},mutations:{FETCH_USERS:function(e,t){e.users.data=t},FETCH_GROUPS:function(e,t){e.groups.data=t},FETCH_REPOSITORIES:function(e,t){e.repositories.data=t},FETCH_ITEMS:function(e,t){e.items.data=t},FETCH_TEMPS:function(e,t){e.temps.data=t}},actions:{getRepositories:function(e,t){return Object(Z["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.commit,n=[],a.next=4,ae.a.get("/user/".concat(t,"/repositories")).then((function(e){e.data.result.forEach((function(e){n.some((function(t){return t.id==e.id}))||n.push(e)}))})).catch((function(e){console.log("Error retrieving repositories : "+e.response.data.message)}));case 4:r("FETCH_REPOSITORIES",n);case 5:case"end":return a.stop()}}),a)})))()},getGroups:function(e){return Object(Z["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.commit,r=e.getters,n=r.users,t.next=4,ae.a.get("/user/".concat(n[0].name,"/groups")).then((function(e){a("FETCH_GROUPS",e.data.result)})).catch((function(e){console.log("Error retrieving groups : "+e.response.data.message)}));case 4:case"end":return t.stop()}}),t)})))()},getItems:function(e,t){var a,r,n=e.getters,o=t.repoName,s=t.groupName,i=t.dirID,c=n.groups,u=n.repositories;console.log(c,u),c.forEach((function(e){e.name==s&&(a=e.id)})),u.forEach((function(e){e.name==o&&(r=e.id)})),console.log(a,r),ae.a.get("/Items?repoID=".concat(r,"&grpID=").concat(a,"&dirID=").concat(i.id)).then((function(e){var t=e.data.result;t.forEach((function(e){"DIRECTORY"==e.type&&(e.children=[])})),i.children=t})).catch((function(e){console.log("Error retrieving items : "+e.response.data.message)}))},getItemsRoot:function(e,t){var a,r,n,o=e.commit,s=e.getters,i=t.repoName,c=t.groupName,u=s.groups,l=s.repositories;u.forEach((function(e){e.name===c&&(a=e.id)})),l.forEach((function(e){e.name==i&&(r=e.id)})),console.log(a,r),ae.a.get("/Items?repoID=".concat(r,"&grpID=").concat(a)).then((function(e){n=e.data.result,n.forEach((function(e){"DIRECTORY"==e.type&&(e.children=[])})),o("FETCH_ITEMS",e.data.result)})).catch((function(e){console.log("Error retrieving items : "+e.response.data.message)}))},getTemps:function(e,t){var a=e.commit,r=t.repoName,n=t.groupName,o={repoName:r,groupName:n};a("FETCH_TEMPS",o)},getUser:function(e,t){var a=e.commit;console.log(t);var r=[{name:t}];console.log(r),a("FETCH_USERS",r)},addUserToGroup:function(e,t){var a=e.state,r=t.userLogin,n=t.groupName,o={userLogin:r,groupName:n};return new Promise((function(e,t){ae.a.post("/user/group/add",o,{}).then((function(t){"success"===t.data.status&&e("L'utilisateur ".concat(r," a été ajouté au groupe ").concat(n,".")),a.groups.data.push(n)})).catch((function(e){e.response&&console.log("Error adding user ".concat(r," to ").concat(n,"  : ")+e.response.data.message),t("Erreur lors de l'ajout de ".concat(r," à ").concat(n,"."))}))}))},removeUserFromGroup:function(e,t){var a=e.state,r=t.userLogin,n=t.groupName,o={userLogin:r,groupName:n};return new Promise((function(e,t){ae.a.post("/user/group/remove",o,{}).then((function(t){-1!=a.groups.data.indexOf(n)&&a.groups.data.splice(a.groups.data.indexOf(n),1),"success"===t.data.status&&e("L'utilisateur ".concat(r," a été retiré du groupe ").concat(n,"."))})).catch((function(e){e.response&&console.log("Erreur lors du retrait de l'utilisateur ".concat(r," du groupe ").concat(n,"  : ")+e.response.data.message),t("Erreur lors du retrait de l'utilisateur ".concat(r," du groupe ").concat(n,"."))}))}))},addUser:function(e,t){var a=e.state;return new Promise((function(e,r){a.userLogin=t.login,ae.a.post("/user/create",t,{}).then((function(a){"success"===a.data.status&&e("L'utilisateur ".concat(t.login," a été crée."))})).catch((function(e){e.response?console.log("Error adding user ".concat(t.login," : ").concat(e.response.data.message)):console.log("Error adding user ".concat(t.login," : ").concat(e)),r("Erreur lors de la création de l'utilisateur ".concat(t.login,"."))}))}))},getUserGroups:function(e,t){var a=e.state,r=t.userLogin;return new Promise((function(e,t){ae.a.get("/user/".concat(r,"/groups")).then((function(t){if("success"==t.data.status){var n=[];t.data.result.forEach((function(e){return n.push(e.name)})),a.userLogin=r}e(t.data.result)})).catch((function(e){e.response?e.response.data.message.includes("User not found.")&&t("User not found."):console.log("Unable to retrieve groups : "+e),t(e)}))}))}},getters:{users:function(e){return e.users.data},groups:function(e){return e.groups.data},repositories:function(e){return e.repositories.data},items:function(e){return e.items.data},temps:function(e){return e.temps.data}},modules:{}}),oe=a("f309");r["a"].use(oe["a"]);var se=new oe["a"]({}),ie=a("68ad"),ce=a.n(ie),ue={url:"https://semaphore-keycloak2.data4citizen.com/auth/",realm:"Vanilla7",clientId:"portail"},le=ce()(ue),de={install:function(e){e.$keycloak=le}};de.install=function(e){e.$keycloak=le,Object.defineProperties(e.prototype,{$keycloak:{get:function(){return le}}})},r["a"].use(de);var pe=de;r["a"].config.productionTip=!1,r["a"].use(pe),r["a"].$keycloak.init({onLoad:"login-required",checkLoginIframe:!1}).then((function(){new r["a"]({router:W,store:ne,vuetify:se,render:function(e){return e(J)}}).$mount("#app")}))},"7dc5":function(e){e.exports=JSON.parse('{"baseURL":"https://semaphore-gravitee-gateway.data4citizen.com/vanilla-api"}')},"9ea8":function(e,t,a){},f9c4:function(e,t,a){e.exports=a.p+"img/vanilla.6e506a77.png"}});
//# sourceMappingURL=app.6e7e86ea.js.map