(function(t){function e(e){for(var r,s,i=e[0],c=e[1],u=e[2],d=0,p=[];d<i.length;d++)s=i[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&p.push(n[s][0]),n[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);l&&l(e);while(p.length)p.shift()();return o.push.apply(o,u||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],r=!0,i=1;i<a.length;i++){var c=a[i];0!==n[c]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=a[0]))}return t}var r={},n={app:0},o=[];function s(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=r,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(a,r,function(e){return t[e]}.bind(null,r));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=c;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"22bc":function(t,e,a){t.exports=a.p+"img/icon_vanilla.1c9b3430.png"},"294d":function(t,e,a){"use strict";a("9ea8")},"3db6":function(t,e,a){t.exports=a.p+"img/vanilla_white.34deb758.png"},4396:function(t,e,a){t.exports=a.p+"img/BPMConseil.0f4f5753.png"},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{staticClass:"grey lighten-4"},[t.loaded&&null==t.selectedGroup?a("v-dialog",{attrs:{persistent:"","max-width":"600px"},model:{value:t.dialogGroup,callback:function(e){t.dialogGroup=e},expression:"dialogGroup"}},[a("v-card",[a("v-card-title",[a("h2",{staticClass:"subheading grey--text"},[t._v("Choisir un groupe")])]),a("v-card-text",[a("v-container",[a("v-row",[a("v-select",{staticClass:"mx-2",attrs:{items:this.userGroups,"item-text":"name",label:"Groupes",outlined:"","return-object":""},model:{value:t.group,callback:function(e){t.group=e},expression:"group"}})],1)],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{staticClass:"mr-4",attrs:{outlined:"",color:"success"},on:{click:t.selectGroup}},[t._v("Confirmer")])],1)],1)],1):t.loaded&&null!=t.selectedGroup?a("div",[a("Navbar"),a("v-main",{staticClass:"mx-4 mb-4 pb-15"},[a("router-view")],1),t._l(t.snackbars.data,(function(e,r){return a("v-snackbar",{key:e.id,style:"bottom: "+(4*r+1)+"em",attrs:{right:"",rounded:"pill",color:e.color,timeout:"5000"},scopedSlots:t._u([{key:"action",fn:function(r){var n=r.attrs;return[a("v-btn",t._b({attrs:{icon:"",text:""},on:{click:function(a){return t.removeSnackbar(e)}}},"v-btn",n,!1),[a("v-icon",[t._v(" mdi-close-circle ")])],1)]}}],null,!0),model:{value:e.aff,callback:function(a){t.$set(e,"aff",a)},expression:"snackbar.aff"}},[t._v(" "+t._s(e.text)+" ")])})),a("Footer")],2):a("div",[a("v-overlay",{attrs:{opacity:"1",value:"true"}},[t.loadingCircular?a("v-progress-circular",{attrs:{indeterminate:"",size:"100"}},[t._v(" "+t._s(t.loadingMsg)+" ")]):a("div",{staticClass:"ma-5"},[a("v-container",{staticClass:"text-center"},[a("v-row",{staticClass:"text-center",attrs:{align:"center",justify:"center","align-content":"center"}},[t._v(" "+t._s(t.loadingMsg)+" ")]),a("v-row",{attrs:{justify:"center"}},[a("v-btn",{attrs:{text:""},on:{click:t.logout}},[a("v-icon",{staticClass:"pr-1"},[t._v("mdi-logout-variant")]),a("span",[t._v("Déconnexion")])],1)],1)],1)],1)],1)],1)],1)},o=[],s=a("b85c"),i=a("5530"),c=(a("d3b7"),a("3ca3"),a("ddb0"),a("7db0"),a("b0c0"),a("a434"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("nav",[r("v-app-bar",{staticClass:"indigo",attrs:{flat:""}},[r("v-app-bar-nav-icon",{staticClass:"white--text",on:{click:function(e){t.drawer=!t.drawer}}}),r("v-toolbar-title",{staticClass:"text-uppercase white--text"},[r("span",{staticClass:"font-weight-light"},[t._v("VANILLA")]),r("span",[t._v(" REPORT VIEWER")])]),r("v-spacer"),r("v-btn",{staticClass:"mx-3",attrs:{text:"",rounded:"",target:"_blank",rel:"noopener noreferrer",href:"https://semaphore-vanilla.data4citizen.com/vanilla"}},[r("v-img",{attrs:{contain:"","max-height":"100","max-width":"120",src:a("3db6")}}),r("v-icon",{staticClass:"ml-1 mt-1",attrs:{medium:"",color:"white"}},[t._v("mdi-open-in-new")])],1)],1),r("v-navigation-drawer",{staticClass:"indigo",attrs:{app:"",temporary:""},scopedSlots:t._u([{key:"append",fn:function(){return[r("v-list",[r("v-list-item",{on:{click:t.logout}},[r("v-list-item-action",[r("v-icon",{staticClass:"white--text"},[t._v("mdi-logout-variant")])],1),r("v-list-item-content",[r("v-list-item-title",{staticClass:"white--text"},[t._v("Déconnexion")])],1)],1)],1)]},proxy:!0}]),model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[r("v-layout",{attrs:{column:"","align-center":""}},[r("v-flex",{staticClass:"mt-5"},[r("v-avatar",{attrs:{size:"100"}},[r("img",{attrs:{src:a("22bc")}})])],1),r("h3",{staticClass:"white--text"},[t._v(t._s(t.userName))])],1),r("v-list",t._l(t.links,(function(e){return r("v-list-item",{key:e.text,attrs:{to:e.route}},[r("v-list-item-action",[r("v-icon",{staticClass:"white--text"},[t._v(t._s(e.icon))])],1),r("v-list-item-content",[r("v-list-item-title",{staticClass:"white--text"},[t._v(t._s(e.text))])],1)],1)})),1)],1)],1)}),u=[],l={name:"Navbar",data:function(){return{drawer:!1,links:[{icon:"mdi-content-paste",text:"Rapports",route:"/"}]}},computed:{userName:function(){return r["a"].$keycloak.tokenParsed.preferred_username}},methods:{logout:function(){r["a"].$keycloak.logout({redirectUri:window.location.origin})}}},d=l,p=a("2877"),f=a("6544"),v=a.n(f),m=a("40dc"),g=a("5bc1"),h=a("8212"),b=a("8336"),x=a("0e8f"),k=a("132d"),_=a("adda"),w=a("a722"),y=a("8860"),C=a("da13"),V=a("1800"),S=a("5d23"),O=a("f774"),R=a("2fa4"),G=a("2a7f"),E=Object(p["a"])(d,c,u,!1,null,null,null),L=E.exports;v()(E,{VAppBar:m["a"],VAppBarNavIcon:g["a"],VAvatar:h["a"],VBtn:b["a"],VFlex:x["a"],VIcon:k["a"],VImg:_["a"],VLayout:w["a"],VList:y["a"],VListItem:C["a"],VListItemAction:V["a"],VListItemContent:S["a"],VListItemTitle:S["b"],VNavigationDrawer:O["a"],VSpacer:R["a"],VToolbarTitle:G["a"]});var P=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-footer",{attrs:{id:"dashboard-core-footer",height:"60",absolute:"",padless:""}},[r("v-container",[r("v-row",{attrs:{align:"center","no-gutters":""}},[r("v-col",{staticClass:"text-center mb-sm-0 mb-5",attrs:{cols:"auto"}},[r("v-btn",{attrs:{icon:"",color:"primary",to:"/"}},[r("v-icon",{attrs:{size:"24px"}},[t._v("mdi-home")])],1)],1),r("v-col",{staticClass:"text-center mb-sm-0 mb-5",attrs:{cols:"auto"}},[r("v-btn",{attrs:{text:"",rounded:"",target:"_blank",rel:"noopener noreferrer",href:"https://semaphore-vanilla.data4citizen.com/vanilla"}},[r("v-img",{attrs:{"max-height":"24","max-width":"90",src:a("f9c4")}})],1)],1),r("v-col",{staticClass:"text-center mb-sm-0 mb-5",attrs:{cols:"auto"}},[r("v-btn",{staticClass:"ma-0",attrs:{text:"",rounded:"",target:"_blank",rel:"noopener noreferrer",href:"http://www.bpm-conseil.com/fr"}},[r("v-img",{attrs:{"max-height":"24","max-width":"90",src:a("4396")}})],1)],1),r("v-spacer",{staticClass:"hidden-sm-and-down"}),r("v-col",{attrs:{cols:"12",md:"auto"}},[r("div",{staticClass:"body-1 font-weight-light pt-6 pt-md-0 text-center"},[t._v(" Copyright © BPM-Conseil, 2013 - "+t._s((new Date).getFullYear())+". ")])])],1)],1)],1)},T=[],U={name:"Footer"},$=U,j=(a("294d"),a("62ad")),I=a("a523"),D=a("553a"),A=a("0fd9"),M=Object(p["a"])($,P,T,!1,null,null,null),N=M.exports;v()(M,{VBtn:b["a"],VCol:j["a"],VContainer:I["a"],VFooter:D["a"],VIcon:k["a"],VImg:_["a"],VRow:A["a"],VSpacer:R["a"]});var B=a("2f62"),z={name:"App",components:{Navbar:L,Footer:N},data:function(){return{dialogGroup:!0,group:null,loaded:!1,loadingMsg:"Loading...",loadingCircular:!0}},computed:Object(i["a"])({},Object(B["b"])(["snackbars","groups","selectedGroup","userGroups"])),beforeMount:function(){this.appLoadData()},methods:{logout:function(){r["a"].$keycloak.logout({redirectUri:window.location.origin})},removeSnackbar:function(t){this.$store.dispatch("removeSnackbar",t)},appLoadData:function(){var t=this;this.manageKeycloakUser().then((function(){t.loaded=!0})).catch((function(){t.loadingMsg="Impossible d'établir la connexion au serveur, veuillez rafraichir la page ou contacter l'administrateur.",t.loadingCircular=!1}))},selectGroup:function(){""!=this.group&&(this.$store.commit("SELECT_GROUP",this.group),this.dialogGroup=!1),this.loadReports()},loadReports:function(){var t=this;this.loaded=!1,this.$store.dispatch("GetReports").then((function(){t.loaded=!0})).catch((function(){t.loadingMsg="Impossible d'établir la connexion au serveur, veuillez rafraichir la page ou contacter l'administrateur.",t.loadingCircular=!1}))},manageKeycloakUser:function(){var t=this,e=r["a"].$keycloak.tokenParsed.preferred_username,a=r["a"].$keycloak.tokenParsed.groups;return new Promise((function(n){t.$store.dispatch("getGroups").then((function(o){var i=o;t.$store.dispatch("getUserGroups",{userLogin:e}).then((function(r){var o,c=r,u=[],l=Object(s["a"])(a);try{var d=function(){var a=o.value;p=c.find((function(t){return t.name==a})),void 0==p?u.push(t.$store.dispatch("addUserToGroup",{userLogin:e,group:i.find((function(t){return t.name==a}))})):c.splice(c.indexOf(p),1)};for(l.s();!(o=l.n()).done;){var p;d()}}catch(g){l.e(g)}finally{l.f()}if(c.length>0){var f,v=Object(s["a"])(c);try{for(v.s();!(f=v.n()).done;){var m=f.value;u.push(t.$store.dispatch("removeUserFromGroup",{userLogin:e,group:m}))}}catch(g){v.e(g)}finally{v.f()}}Promise.all(u).then((function(){t.$store.dispatch("getUserGroups",{userLogin:e}).then((function(){n()}))}))})).catch((function(o){if("User not found."==o){var c={name:e,login:e,password:"Default",mail:r["a"].$keycloak.tokenParsed.email},u=[];t.$store.dispatch("addUser",c).then((function(){var r,n=Object(s["a"])(a);try{var o=function(){var a=r.value;u.push(t.$store.dispatch("addUserToGroup",{userLogin:e,group:i.find((function(t){return t.name==a}))}))};for(n.s();!(r=n.n()).done;)o()}catch(c){n.e(c)}finally{n.f()}})),Promise.all(u).then((function(){t.$store.dispatch("getUserGroups",{userLogin:e}).then((function(){n()}))}))}}))}))}))}},watch:{$route:{immediate:!0,handler:function(){document.title="Vanilla Report Viewer"}}}},F=z,K=a("7496"),H=a("b0af"),J=a("99d9"),q=a("169a"),W=a("f6c4"),X=a("a797"),Y=a("490a"),Q=a("b974"),Z=a("2db4"),tt=Object(p["a"])(F,n,o,!1,null,null,null),et=tt.exports;v()(tt,{VApp:K["a"],VBtn:b["a"],VCard:H["a"],VCardActions:J["a"],VCardText:J["b"],VCardTitle:J["c"],VContainer:I["a"],VDialog:q["a"],VIcon:k["a"],VMain:W["a"],VOverlay:X["a"],VProgressCircular:Y["a"],VRow:A["a"],VSelect:Q["a"],VSnackbar:Z["a"],VSpacer:R["a"]});var at=a("8c4f"),rt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dashboard"},[a("v-container",{staticClass:"my-5"},[a("v-row",{attrs:{align:"start",justify:"center"}},[a("v-col",{attrs:{xs:"12",sm:"6",md:"6",lg:"6"}},[a("v-card",{staticClass:"mx-auto",attrs:{"max-width":"500"}},[a("v-sheet",{staticClass:"pa-4 primary lighten-1"},[a("v-container",{staticClass:"pa-2"},[a("v-row",[a("v-text-field",{attrs:{label:"Rechercher un rapport",dark:"",flat:"","solo-inverted":"","hide-details":"",clearable:"","clear-icon":"mdi-close-circle-outline"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),a("v-row",[a("v-checkbox",{attrs:{dark:"","hide-details":"",label:"Recherche sensible à la casse"},model:{value:t.caseSensitive,callback:function(e){t.caseSensitive=e},expression:"caseSensitive"}}),a("v-spacer"),a("v-btn",{staticClass:"mt-3 white--text",attrs:{icon:"",text:""},on:{click:function(e){t.affTreeview=!1}}},[a("v-icon",[t._v("mdi-format-horizontal-align-left")])],1)],1)],1)],1),a("v-card-text",[a("v-treeview",{attrs:{active:t.selectedReport,items:t.reports,"item-key":"id","return-object":"",search:t.search,filter:t.filter,"open-on-click":"",rounded:"",activatable:"","selected-color":"primary"},scopedSlots:t._u([{key:"prepend",fn:function(e){return[a("v-icon",[t._v(" mdi-content-paste ")])]}},{key:"label",fn:function(e){var r=e.item;return[a("span",{on:{click:function(e){return t.getReport(r)}}},[t._v(t._s(r.name))])]}}])})],1)],1)],1),a("v-col",{attrs:{xs:"12",sm:"6",md:"6",lg:"6"}},[a("div",{domProps:{innerHTML:t._s(t.reportHTML)}})])],1)],1)],1)},nt=[],ot={name:"Dashboard",components:{},data:function(){return{caseSensitive:!1,selectedReport:[],search:""}},methods:{getReport:function(t){this.$store.dispatch("openReport",{userLogin:r["a"].$keycloak.tokenParsed.preferred_username,reportID:t.id})}},computed:Object(i["a"])(Object(i["a"])({},Object(B["b"])(["reports","reportHTML"])),{},{filter:function(){return this.caseSensitive?function(t,e,a){return t[a].indexOf(e)>-1}:void 0}})},st=ot,it=a("ac7c"),ct=a("8dd9"),ut=a("8654"),lt=a("eb2a"),dt=Object(p["a"])(st,rt,nt,!1,null,null,null),pt=dt.exports;v()(dt,{VBtn:b["a"],VCard:H["a"],VCardText:J["b"],VCheckbox:it["a"],VCol:j["a"],VContainer:I["a"],VIcon:k["a"],VRow:A["a"],VSheet:ct["a"],VSpacer:R["a"],VTextField:ut["a"],VTreeview:lt["a"]});var ft=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},vt=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("h1",[t._v("Error 404 : Page not found")])])}],mt={name:"NotFound"},gt=mt,ht=Object(p["a"])(gt,ft,vt,!1,null,null,null),bt=ht.exports;r["a"].use(at["a"]);var xt=[{path:"/",name:"Dashboard",component:pt},{path:"*",component:bt}],kt=new at["a"]({mode:"history",routes:xt}),_t=kt,wt=(a("caad"),a("2532"),a("99af"),a("bc3a")),yt=a.n(wt),Ct=a("7dc5");yt.a.defaults.baseURL=Ct.baseURL,yt.a.defaults.headers.common["X-Gravitee-Api-Key"]="f3510842-ef9b-4ee7-8877-4d59b5d63907",r["a"].use(B["a"]);var Vt=new B["a"].Store({state:{reports:[],groups:[],selectedGroup:null,userGroups:[],snackbars:{id:0,data:[]},reportHTML:null},mutations:{SET_REPORTS:function(t,e){t.reports=e},SET_GROUPS:function(t,e){t.groups=e},SET_USERGROUPS:function(t,e){t.userGroups=e},ADD_SNACKBAR:function(t,e){t.snackbars.data.push(e)},REMOVE_SNACKBAR:function(t,e){t.snackbars.data.splice(e,1)},SELECT_GROUP:function(t,e){t.selectedGroup=e},SET_REPORT:function(t,e){t.reportHTML=e}},actions:{openReport:function(t,e){var a=t.commit,r=t.getters,n=e.userLogin,o=e.reportID;return new Promise((function(t,e){yt.a.get("/view",{params:{repositoryID:1,groupID:r.selectedGroup.id,userLogin:n,reportID:o,format:"html"}}).then((function(t){a("SET_REPORT",t.data)})).catch((function(t){console.log("Error : "+t),e()}))}))},GetReports:function(t){var e=t.commit,a=t.getters;return new Promise((function(t,r){yt.a.get("/reports",{params:{repositoryID:1,groupID:a.selectedGroup.id}}).then((function(a){"success"===a.data.status&&e("SET_REPORTS",a.data.result),t()})).catch((function(t){console.log("Error : "+JSON.stringify(t)),r()}))}))},addSnackbar:function(t,e){var a=t.state,r=t.commit,n=t.dispatch;e.id=a.snackbars.id,a.snackbars.id++,r("ADD_SNACKBAR",e),setTimeout((function(t){t("removeSnackbar",e)}),5e3,n)},removeSnackbar:function(t,e){var a=t.state,r=t.commit,n=a.snackbars.data.indexOf(e);-1!=n&&r("REMOVE_SNACKBAR",n)},getUserGroups:function(t,e){var a=t.commit,r=e.userLogin;return new Promise((function(t,e){yt.a.get("/user/".concat(r,"/groups")).then((function(e){"success"==e.data.status&&a("SET_USERGROUPS",e.data.result),t(e.data.result)})).catch((function(t){t.response.data.message&&t.response.data.message.includes("User not found.")?e("User not found."):console.log("Unable to retrieve groups : "+t),e(t)}))}))},getGroups:function(t){var e=t.commit;return new Promise((function(t,a){yt.a.get("/groups").then((function(a){"success"==a.data.status&&e("SET_GROUPS",a.data.result),t(a.data.result)})).catch((function(t){t.reponse?console.log("Unable to retrieve groups : "+t.response.data.message):console.log("Unable to retrieve groups : "+t),a(t)}))}))},addUser:function(t,e){var a=t.state;return new Promise((function(t,r){a.userLogin=e.login,yt.a.post("/user/create",e,{}).then((function(a){"success"===a.data.status&&t("L'utilisateur ".concat(e.login," a été crée."))})).catch((function(t){t.response?console.log("Error adding user ".concat(e.login," : ").concat(t.response.data.message)):console.log("Error adding user ".concat(e.login," : ").concat(t)),r("Erreur lors de la création de l'utilisateur ".concat(e.login,"."))}))}))},addUserToGroup:function(t,e){var a=t.state,r=e.userLogin,n=e.group,o={userLogin:r,groupID:n.id};return new Promise((function(t,e){yt.a.post("/user/group/add",o,{}).then((function(e){"success"===e.data.status&&(a.userGroups.push(n.name),t("L'utilisateur ".concat(r," a été ajouté au groupe ").concat(n.name,".")))})).catch((function(t){console.log("Error adding user ".concat(r," to ").concat(n.name,"  : ")+t),e("Erreur lors de l'ajout de ".concat(r," à ").concat(n.name,"."))}))}))},removeUserFromGroup:function(t,e){var a=t.state,r=e.userLogin,n=e.group,o={userLogin:r,groupID:n.id};return new Promise((function(t,e){yt.a.post("/user/group/remove",o,{}).then((function(e){-1!=a.userGroups.indexOf(n.name)&&a.userGroups.splice(a.groups.data.indexOf(n.name),1),"success"===e.data.status&&t("L'utilisateur ".concat(r," a été retiré du groupe ").concat(n.name,"."))})).catch((function(t){console.log("Erreur lors du retrait de l'utilisateur ".concat(r," du groupe ").concat(n.name,"  : ")+t),e("Erreur lors du retrait de l'utilisateur ".concat(r," du groupe ").concat(n.name,"."))}))}))}},getters:{selectedGroup:function(t){return t.selectedGroup}},modules:{}}),St=a("f309");r["a"].use(St["a"]);var Ot=new St["a"]({}),Rt=a("68ad"),Gt=a.n(Rt),Et={url:"https://semaphore-keycloak2.data4citizen.com/auth/",realm:"Vanilla7",clientId:"reportviewer"},Lt=Gt()(Et),Pt={install:function(t){t.$keycloak=Lt}};Pt.install=function(t){t.$keycloak=Lt,Object.defineProperties(t.prototype,{$keycloak:{get:function(){return Lt}}})},r["a"].use(Pt);var Tt=Pt;r["a"].config.productionTip=!1,r["a"].use(Tt),r["a"].$keycloak.init({onLoad:"login-required",checkLoginIframe:!1}).then((function(){new r["a"]({router:_t,store:Vt,vuetify:Ot,render:function(t){return t(et)}}).$mount("#app")}))},"7dc5":function(t){t.exports=JSON.parse('{"baseURL":"https://semaphore-gravitee-gateway.data4citizen.com/vanilla-api"}')},"9ea8":function(t,e,a){},f9c4:function(t,e,a){t.exports=a.p+"img/vanilla.6e506a77.png"}});
//# sourceMappingURL=app.10bcd1a6.js.map